;; definice transakcni pameti
(stmx:transactional
 (defclass foo ()
   ((value1 :type integer :initarg :value1 :initform 0))))


(defparameter *counter* (make-instance 'foo))


(defun increase (instance)
  (stmx:atomic
   (incf (slot-value instance 'value1) 1)))


(stmx:transactional
 (defclass limited-buffer ()
   ((size :type integer :initarg :size :initform 20)
    (full :initform 0)
    (r :initform 0)
    (f :initform 0)
    (buffer :initform nil))))

(defmethod initialize-instance :after ((instance limited-buffer) &key)
  (with-slots (size buffer) instance
    (setf buffer (make-array size))))
